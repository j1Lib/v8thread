function v8t(t,e,i){this.url=t,this.partial=1024*(i||50)-320,this.thread=e||5,this.response={},this.ajax(0,this.partial,function(t){this.range=t.getResponseHeader("Content-Range").split("/")[1],this.finish(0,t);for(var e=1;e<this.range/this.partial;e++)e<=this.thread&&this.handle(e)},function(t){window.xhr=t,console.log(t.status)});var s;this.done=function(t){return"function"==typeof t?s=t:s&&s.call(this,t),this};var n;return this.load=function(t){return"function"==typeof t?n=t:n&&n.call(this,t),this},this.config={createBlob:!0},this}v8t.prototype.concat=function(t,e){var i=new t.constructor(t.length+e.length);return i.set(t,0),i.set(e,t.length),i},v8t.prototype.handle=function(t){var e=this.partial*t,i=e+this.partial;i>=this.range&&(i=this.range),this.ajax(e+1,i,function(e){this.finish(t,e),t+=parseInt(this.thread),t<this.range/this.partial&&this.handle(t)},function(e){200==e.status&&this.finish(t,e)})},v8t.prototype.finish=function(t,e){this.response[t]=new Uint8Array(e.response);var i=Object.keys(this.response).length;if(i>=this.range/this.partial)if(this.config.createBlob){for(var t=1;i>t;t++)this.response[t]=this.concat(this.response[t-1],this.response[t]);this.done(URL.createObjectURL(new Blob([this.response[i-1]],{type:this.config.mimeType})))}else this.done();else 0==t?(this.config.mimeType=e.getResponseHeader("Content-Type"),this.config.createBlob?this.done(URL.createObjectURL(new Blob([this.response[i-1]],{type:this.config.mimeType}))):this.done()):this.load(parseInt(100*i/this.range*this.partial))},v8t.prototype.ajax=function(t,e,i,s){var n=this,r=new XMLHttpRequest;r.onreadystatechange=function(){4==this.readyState&&(206==this.status?i&&i.call(n,r):s&&s.call(n,r))},r.open("GET",this.url,!0),r.setRequestHeader("Range","bytes="+t+"-"+e),r.responseType="arraybuffer",r.send()},v8t.prototype.init=function(t){switch(t.tagName){case"IMG":if(t.hasAttribute("thread-src")){var e,i=document.createElement("canvas"),s=0,n=0;return new v8t(t.getAttribute("thread-src"),t.getAttribute("thread")||5,t.getAttribute("partial")||50).done(function(e){t.onload=function(){URL.revokeObjectURL(this.src)},t.src=e}).load(function(r){2==r&&(i.width=t.width,i.height=t.height,e=i.getContext("2d"),e.fillStyle="#424242",e.strokeStyle="#fff"),e.fillRect(0,0,i.width,i.height),s+=Math.PI/50*r,n+=Math.PI/200*r,e.arc(i.width/2,i.height/2,70,n,s/2,!1),e.font="30px Arial",e.strokeText("j1Lib",i.width-100,i.height-50),e.stroke(),t.src=i.toDataURL()})}case"AUDIO":case"VIDEO":if(t.hasAttribute("thread-src")){window.mediaSource=new MediaSource;var r=0;mediaSource.addEventListener("sourceopen",function(){window.sourceBuffer=mediaSource.addSourceBuffer(t.getAttribute("type")||'video/webm; codecs="vorbis,vp8"'),sourceBuffer.addEventListener("updateend",function(){++r>=u?mediaSource.endOfStream():c&&sourceBuffer.appendBuffer(o.response[r]),a=!1})},!1),t.onload=function(){URL.revokeObjectURL(this.src)},t.src=URL.createObjectURL(mediaSource);var o,a=!1,h=!1,c=!1,u=0;return new v8t(t.getAttribute("thread-src"),5,t.getAttribute("partial")||50).done(function(){h?u>r&&(c=!0,o=this):(u=this.range/this.partial,h=!0,t.hasAttribute("autoplay")&&t.play()),sourceBuffer.appendBuffer(this.response[r])}).load(function(){!a&&this.response[r]&&(a=!0,sourceBuffer.appendBuffer(this.response[r]))}).config.createBlob=!1}}},v8t.prototype.support=["img","video","audio"],function(){v8t.prototype.support.forEach(function(t){for(var e=document.getElementsByTagName(t),i=0;i<e.length;i++)v8t.prototype.init(e[i])})}();