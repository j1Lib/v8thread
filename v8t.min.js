function v8t(t,e,n){this.url=t,this.partial=1024*(n||50)-320,this.thread=e||5,this.response={},this.ajax(0,this.partial,function(t){this.range=t.contentRange.split("/")[1],this.finish(0,t);for(var e=1;e<this.range/this.partial;e++)e<=this.thread&&this.handle(e)},function(t){console.log("Error: "+t.status)});var r;this.done=function(t){return"function"==typeof t?r=t:r&&r.call(this,t),this};var i;return this.load=function(t){return"function"==typeof t?i=t:i&&i.call(this,t),this},this.config={createBlob:!0},this}v8t.prototype.concat=function(t,e){var n=new t.constructor(t.length+e.length);return n.set(t,0),n.set(e,t.length),n},v8t.prototype.handle=function(t){var e=this.partial*t,n=e+this.partial;n>=this.range&&(n=this.range),this.ajax(e+1,n,function(e){this.finish(t,e),t+=parseInt(this.thread),t<this.range/this.partial&&this.handle(t)},function(e){200==e.status&&this.finish(t,e)})},v8t.prototype.finish=function(t,e){this.response[t]=e.arrayBuffer;var n=Object.keys(this.response).length;if(n>=this.range/this.partial)if(this.config.createBlob){for(var t=1;n>t;t++)this.response[t]=this.concat(this.response[t-1],this.response[t]);this.done(URL.createObjectURL(new Blob([this.response[n-1]],{type:this.config.mimeType})))}else this.done();else 0==t?(this.config.mimeType=e.contentType,this.config.createBlob?this.done(URL.createObjectURL(new Blob([this.response[n-1]],{type:this.config.mimeType}))):this.done()):this.load(parseInt(100*n/this.range*this.partial))},v8t.prototype.ajaxResult=function(t,e,n,r){return{contentRange:t,arrayBuffer:e,status:n,contentType:r}},v8t.prototype.ajax=function(t,e,n,r){var i,s=this;if(fetch)fetch(this.url,{method:"GET",cache:"force-cache",headers:new Headers({Range:"bytes="+t+"-"+e})}).then(function(t){return i=s.ajaxResult(t.headers.get("Content-Range"),"",t.status,t.headers.get("Content-Type")),t.arrayBuffer()}).then(function(t){i.arrayBuffer=new Uint8Array(t),n&&n.call(s,i)});else{var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&(i=s.ajaxResult(a.getResponseHeader("Content-Range"),new Uint8Array(a.response),this.status,a.getResponseHeader("Content-Type")),206==this.status?n&&n.call(s,i):r&&r.call(s,i))},a.open("GET",this.url,!0),a.setRequestHeader("Range","bytes="+t+"-"+e),a.responseType="arraybuffer",a.send()}},v8t.prototype.init=function(t){switch(t.tagName){case"IMG":if(t.hasAttribute("thread-src")){var e,n=document.createElement("canvas"),r=0,i=0;return new v8t(t.getAttribute("thread-src"),t.getAttribute("thread")||5,t.getAttribute("partial")||50).done(function(e){t.onload=function(){URL.revokeObjectURL(this.src)},t.src=e}).load(function(s){2==s&&(n.width=t.width,n.height=t.height,e=n.getContext("2d"),e.fillStyle="#424242",e.strokeStyle="#fff"),e.fillRect(0,0,n.width,n.height),r+=Math.PI/50*s,i+=Math.PI/200*s,e.arc(n.width/2,n.height/2,70,i,r/2,!1),e.font="30px Arial",e.strokeText("j1Lib",n.width-100,n.height-50),e.stroke(),t.src=n.toDataURL()})}case"AUDIO":case"VIDEO":if(t.hasAttribute("thread-src")){var s,a=new MediaSource,o=0,h=t.getAttribute("type")||'video/webm; codecs="vorbis,vp8"';if(MediaSource.isTypeSupported(h)){a.addEventListener("sourceopen",function(){s=a.addSourceBuffer(h),s.addEventListener("updateend",function(){++o>=l?a.endOfStream():f&&s.appendBuffer(c.response[o]),p=!1})},!1),t.onload=function(){URL.revokeObjectURL(this.src)},t.src=URL.createObjectURL(a);var c,p=!1,u=!1,f=!1,l=0;return new v8t(t.getAttribute("thread-src"),5,t.getAttribute("partial")||50).done(function(){u?l>o&&(f=!0,c=this):(l=this.range/this.partial,u=!0,t.hasAttribute("autoplay")&&t.play()),s.appendBuffer(this.response[o])}).load(function(){!p&&this.response[o]&&(p=!0,s.appendBuffer(this.response[o]))}).config.createBlob=!1}t.src=t.getAttribute("thread-src")}}},v8t.prototype.support=["img","video","audio"],function(){v8t.prototype.support.forEach(function(t){for(var e=document.getElementsByTagName(t),n=0;n<e.length;n++)v8t.prototype.init(e[n])})}();