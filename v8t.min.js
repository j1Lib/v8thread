function v8t(t,e,n){this.url=t,this.partial=1024*(n||50)-320,this.thread=e||5,this.response={},this.ajax(0,this.partial,function(t){this.range=t.contentRange.split("/")[1],this.finish(0,t);for(var e=1;e<this.range/this.partial;e++)e<=this.thread&&this.handle(e)},function(t){console.log("Error: "+t.status)});var i;this.done=function(t){return"function"==typeof t?i=t:i&&i.call(this,t),this};var r;return this.load=function(t){return"function"==typeof t?r=t:r&&r.call(this,t),this},this.config={createBlob:!0},this}v8t.prototype.concat=function(t,e){var n=new t.constructor(t.length+e.length);return n.set(t,0),n.set(e,t.length),n},v8t.prototype.handle=function(t){var e=this.partial*t,n=e+this.partial;n>=this.range&&(n=this.range),this.ajax(e+1,n,function(e){this.finish(t,e),t+=parseInt(this.thread),t<this.range/this.partial&&this.handle(t)},function(e){200==e.status&&this.finish(t,e)})},v8t.prototype.finish=function(t,e){this.response[t]=e.arrayBuffer;var n=Object.keys(this.response).length,i=this;if(n>=this.range/this.partial)if(this.config.createBlob){for(var t=1;n>t;t++)this.response[t]=this.concat(this.response[t-1],this.response[t]);this.createBlob(this.response[n-1],this.config.mimeType,function(t){i.done(t)})}else this.done();else 0==t?(this.config.mimeType=e.contentType,this.config.createBlob?this.createBlob(this.response[n-1],this.config.mimeType,function(t){i.done(t)}):this.done()):this.load(parseInt(100*n/this.range*this.partial))},v8t.prototype.createBlob=function(t,e,n){var i=URL.createObjectURL(new Blob(["self.onmessage=function(e){postMessage(URL.createObjectURL(new Blob([e.data], { type: '"+e+"' })))}"],{type:"application/javascript"})),r=new Worker(i);r.onmessage=function(t){n(t.data),URL.revokeObjectURL(i)},r.postMessage(t)},v8t.prototype.ajaxResult=function(t,e,n,i){return{contentRange:t,arrayBuffer:e,status:n,contentType:i}},v8t.prototype.ajax=function(t,e,n,i){var r,s=this;if(fetch)fetch(this.url,{method:"GET",cache:"force-cache",headers:new Headers({Range:"bytes="+t+"-"+e})}).then(function(t){return r=s.ajaxResult(t.headers.get("Content-Range"),"",t.status,t.headers.get("Content-Type")),t.arrayBuffer()}).then(function(t){r.arrayBuffer=new Uint8Array(t),n&&n.call(s,r)});else{var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&(r=s.ajaxResult(a.getResponseHeader("Content-Range"),new Uint8Array(a.response),this.status,a.getResponseHeader("Content-Type")),206==this.status?n&&n.call(s,r):i&&i.call(s,r))},a.open("GET",this.url,!0),a.setRequestHeader("Range","bytes="+t+"-"+e),a.responseType="arraybuffer",a.send()}},v8t.prototype.init=function(t){switch(t.tagName){case"IMG":if(t.hasAttribute("thread-src")){var e,n=document.createElement("canvas"),i=0,r=0,s=0;window.a=new v8t(t.getAttribute("thread-src"),t.getAttribute("thread")||5,t.getAttribute("partial")||50).done(function(e){s++,t.src=e,t.onload=function(){URL.revokeObjectURL(this.src)}}).load(function(a){2==Object.keys(this.response).length&&(n.width=t.width,n.height=t.height,e=n.getContext("2d"),e.fillStyle="#424242",e.strokeStyle="#fff"),e.fillRect(0,0,n.width,n.height),i+=Math.PI/50*a,r+=Math.PI/200*a,e.arc(n.width/2,n.height/2,70,r,i/2,!1),e.font="30px Arial",e.strokeText("j1Lib",n.width-100,n.height-50),e.stroke(),n.toBlob(function(e){1==s&&(t.src=URL.createObjectURL(e))},"image/jpeg")})}break;case"AUDIO":case"VIDEO":if(t.hasAttribute("thread-src")){var a,o=new MediaSource,h=0,c=t.getAttribute("type")||'video/webm; codecs="vorbis,vp8"';if(MediaSource.isTypeSupported(c)){o.addEventListener("sourceopen",function(){a=o.addSourceBuffer(c),a.addEventListener("updateend",function(){++h>=d?o.endOfStream():l&&a.appendBuffer(p.response[h]),u=!1})},!1),t.onload=function(){URL.revokeObjectURL(this.src)},t.src=URL.createObjectURL(o);var p,u=!1,f=!1,l=!1,d=0;new v8t(t.getAttribute("thread-src"),5,t.getAttribute("partial")||50).done(function(){f?d>h&&(l=!0,p=this):(d=this.range/this.partial,f=!0,t.hasAttribute("autoplay")&&t.play(),MediaSource.isTypeSupported(this.config.mimeType)),a.appendBuffer(this.response[h])}).load(function(){!u&&this.response[h]&&(u=!0,a.appendBuffer(this.response[h]))}).config.createBlob=!1}else t.src=t.getAttribute("thread-src")}}t.removeAttribute("thread"),t.removeAttribute("partial"),t.removeAttribute("thread-src")},v8t.prototype.support=["img","video","audio"],function(){v8t.prototype.support.forEach(function(t){for(var e=document.getElementsByTagName(t),n=0;n<e.length;n++)v8t.prototype.init(e[n])})}();