function v8t(t,e,r){this.url=t,this.partial=1024*(r||50)-320,this.thread=e||5,this.response={},this.ajax(0,this.partial,function(t){this.range=t.contentRange.split("/")[1],this.finish(0,t);for(var e=1;e<this.range/this.partial;e++)e<=this.thread&&this.handle(e)},function(t){console.log("Error: "+t.status)});var i;this.done=function(t){return"function"==typeof t?i=t:i&&i.call(this,t),this};var n;return this.load=function(t){return"function"==typeof t?n=t:n&&n.call(this,t),this},this.config={createBlob:!0},this}v8t.prototype.concat=function(t,e){var r=new t.constructor(t.length+e.length);return r.set(t,0),r.set(e,t.length),r},v8t.prototype.handle=function(t){var e=this.partial*t,r=e+this.partial;r>=this.range&&(r=this.range),this.ajax(e+1,r,function(e){this.finish(t,e),t+=parseInt(this.thread),t<this.range/this.partial&&this.handle(t)},function(e){200==e.status&&this.finish(t,e)})},v8t.prototype.finish=function(t,e){this.response[t]=e.arrayBuffer;var r=Object.keys(this.response).length;if(r>=this.range/this.partial)if(this.config.createBlob){for(var t=1;r>t;t++)this.response[t]=this.concat(this.response[t-1],this.response[t]);this.done(URL.createObjectURL(new Blob([this.response[r-1]],{type:this.config.mimeType})))}else this.done();else 0==t?(this.config.mimeType=e.contentType,this.config.createBlob?this.done(URL.createObjectURL(new Blob([this.response[r-1]],{type:this.config.mimeType}))):this.done()):this.load(parseInt(100*r/this.range*this.partial))},v8t.prototype.ajaxResult=function(t,e,r,i){return{contentRange:t,arrayBuffer:e,status:r,contentType:i}},v8t.prototype.ajax=function(t,e,r,i){var n,s=this;if(fetch)fetch(this.url,{method:"GET",cache:"force-cache",headers:new Headers({Range:"bytes="+t+"-"+e})}).then(function(t){return n=s.ajaxResult(t.headers.get("Content-Range"),"",t.status,t.headers.get("Content-Type")),t.arrayBuffer()}).then(function(t){n.arrayBuffer=new Uint8Array(t),r&&r.call(s,n)});else{var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&(n=s.ajaxResult(a.getResponseHeader("Content-Range"),new Uint8Array(a.response),this.status,a.getResponseHeader("Content-Type")),206==this.status?r&&r.call(s,n):i&&i.call(s,n))},a.open("GET",this.url,!0),a.setRequestHeader("Range","bytes="+t+"-"+e),a.responseType="arraybuffer",a.send()}},v8t.prototype.init=function(t){switch(t.tagName){case"IMG":if(t.hasAttribute("thread-src")){var e,r=document.createElement("canvas"),i=0,n=0;new v8t(t.getAttribute("thread-src"),t.getAttribute("thread")||5,t.getAttribute("partial")||50).done(function(e){t.src=e,t.onload=function(){URL.revokeObjectURL(this.src)}}).load(function(s){2==Object.keys(this.response).length&&(r.width=t.width,r.height=t.height,e=r.getContext("2d"),e.fillStyle="#424242",e.strokeStyle="#fff"),e.fillRect(0,0,r.width,r.height),i+=Math.PI/50*s,n+=Math.PI/200*s,e.arc(r.width/2,r.height/2,70,n,i/2,!1),e.font="30px Arial",e.strokeText("j1Lib",r.width-100,r.height-50),e.stroke(),t.src=r.toDataURL()})}break;case"AUDIO":case"VIDEO":if(t.hasAttribute("thread-src")){var s,a=new MediaSource,o=0,h=t.getAttribute("type")||'video/webm; codecs="vorbis,vp8"';if(MediaSource.isTypeSupported(h)){a.addEventListener("sourceopen",function(){s=a.addSourceBuffer(h),s.addEventListener("updateend",function(){++o>=d?a.endOfStream():f&&s.appendBuffer(c.response[o]),p=!1})},!1),t.onload=function(){URL.revokeObjectURL(this.src)},t.src=URL.createObjectURL(a);var c,p=!1,u=!1,f=!1,d=0;new v8t(t.getAttribute("thread-src"),5,t.getAttribute("partial")||50).done(function(){u?d>o&&(f=!0,c=this):(d=this.range/this.partial,u=!0,t.hasAttribute("autoplay")&&t.play(),MediaSource.isTypeSupported(this.config.mimeType)),s.appendBuffer(this.response[o])}).load(function(){!p&&this.response[o]&&(p=!0,s.appendBuffer(this.response[o]))}).config.createBlob=!1}else t.src=t.getAttribute("thread-src")}}t.removeAttribute("thread"),t.removeAttribute("partial"),t.removeAttribute("thread-src")},v8t.prototype.support=["img","video","audio"],function(){v8t.prototype.support.forEach(function(t){for(var e=document.getElementsByTagName(t),r=0;r<e.length;r++)v8t.prototype.init(e[r])})}();